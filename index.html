<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<title>Lista De Compras</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
<style>
  .particles{position:fixed;top:0;left:0;width:100vw;height:100vh;overflow:hidden;z-index:-1;background:linear-gradient(135deg,#ffa726,#fb8c00)}
  .particle{position:absolute;width:6px;height:6px;background:rgba(0,0,0,.6);border-radius:50%;animation:float 10s linear infinite}
  @keyframes float{0%{transform:translate(0,0);opacity:1}100%{transform:translate(var(--dx),var(--dy));opacity:0}}

  body{font-family:Arial,sans-serif;margin:20px 0;padding:0 10px}
  .titulo-container{text-align:center;margin-top:30px}
  h2{display:inline-block;font-size:2.5em;background:#ff9800;color:#fff;border:4px solid #e65100;border-radius:15px;padding:20px 30px;box-shadow:3px 3px 10px rgba(0,0,0,.3);animation:tilt 3s ease-in-out infinite alternate}
  @keyframes tilt{0%{transform:rotate(-2deg) scale(1)}100%{transform:rotate(2deg) scale(1.05)}}

  .btn-container,#add-box{display:flex;flex-wrap:wrap;justify-content:center;gap:10px;margin:20px 0}
  button{padding:14px 22px;font-size:1em;font-weight:bold;border:none;border-radius:12px;color:#fff;cursor:pointer;transition:transform .2s,box-shadow .2s;display:inline-flex;align-items:center;gap:8px}
  button:hover{transform:scale(1.1);box-shadow:0 4px 10px rgba(0,0,0,.2)}
  .btn-marcar{background:#4caf50}
  .btn-desmarcar{background:#f44336}
  .btn-pdf{background:#2196f3}
  .btn-share{background:#9c27b0}

  input[type=checkbox]{appearance:none;width:25px;height:25px;border:2px solid #888;border-radius:5px;background:#fff;cursor:pointer;position:relative;transition:all .2s}
  input[type=checkbox]:checked{background:#4caf50;border-color:#4caf50}
  input[type=checkbox]::after{content:"";position:absolute;top:4px;left:8px;width:6px;height:12px;border:solid #fff;border-width:0 2px 2px 0;transform:rotate(45deg);opacity:0;transition:opacity .2s}
  input[type=checkbox]:checked::after{opacity:1}
  input[type=checkbox]:active{transform:scale(1.3)}

  #newItem{padding:8px;width:200px;font-size:1em;border-radius:8px;border:1px solid #ccc}
  @media(max-width:600px){button,#newItem{width:100%}}

  table{width:100%;border-collapse:collapse;margin-top:20px;background:#fff;border-radius:10px;overflow:hidden;box-shadow:2px 2px 8px rgba(0,0,0,.2)}
  th,td{border:1px solid #ccc;padding:12px;text-align:left}
  th{background:#ffcc80}
  .faltante{background-color:#ffdddd !important}
</style>
</head>
<body>
  <div class="particles"></div>
  <div class="titulo-container"><h2><i class="fas fa-shopping-cart"></i> Lista De Compras</h2></div>
  <div class="btn-container">
    <button class="btn-marcar" onclick="cambiarTodos(true)"><i class="fas fa-check-square"></i> Marcar todos</button>
    <button class="btn-desmarcar" onclick="cambiarTodos(false)"><i class="fas fa-square"></i> Desmarcar todos</button>
    <button class="btn-pdf" onclick="descargarPDF()"><i class="fas fa-file-pdf"></i> PDF</button>
    <button class="btn-share" onclick="compartir()"><i class="fas fa-share-alt"></i> Compartir</button>
  </div>
  <div id="add-box">
    <input type="text" id="newItem" placeholder="Nuevo producto...">
    <button class="btn-marcar" onclick="agregarProducto()">Agregar</button>
  </div>
  <table>
    <thead><tr><th>Producto</th><th>Falta?</th></tr></thead>
    <tbody id="lista"></tbody>
  </table>
<script>
  const pCont=document.querySelector('.particles');
  for(let i=0;i<60;i++){
    let p=document.createElement('div');
    p.className='particle';
    p.style.top=Math.random()*100+'%';
    p.style.left=Math.random()*100+'%';
    p.style.setProperty('--dx',(Math.random()*200-100)+'vw');
    p.style.setProperty('--dy',(Math.random()*200-100)+'vh');
    pCont.appendChild(p);
  }

  const productos=["Pan","Alfalfa","Aceite","Papa","Aguacate","Bolsa asa","Bolsa de 30 x 40","Bolsa de papel","Bolsa de 15 x 25","Sal","Chipotle","Rajas","Pata","Huevos","Leche","Polvos","Quesillo","Queso","Desengrasante","JabÃ³n","JabÃ³n para manos","Gel antibacterial","Aceite de oliva","Vasos de medio litro","Vasos de litro","Tapas de medio","Papas a la francesa","Pan molido","Carne","Pollo","Cebolla","Salchicha","JamÃ³n","PÃ¡palo","LimÃ³n","Carnation","AzÃºcar","Vainilla","Enchilada","Servilletas","Trapos","Guantes","Refrescos de sabor","Refrescos de 2 litros","Pelapapas","Fibra de metal","Flan","Carlota de limÃ³n","Catsup","Salsa","Cucharas de plÃ¡stico","Agua simple para las de sabor","Agua simple para beber"].sort();
  const lista=document.getElementById("lista"),LS_KEY="lista_compra";

  const guardarEstado=()=>localStorage.setItem(LS_KEY,JSON.stringify([...lista.rows].map(r=>[r.cells[0].innerText,r.querySelector("input").checked])));
  const cargarEstado=()=>JSON.parse(localStorage.getItem(LS_KEY)||"[]").forEach(([p,c])=>{
    let fila=[...lista.rows].find(r=>r.cells[0].innerText===p);
    if(fila){let chk=fila.querySelector("input");chk.checked=c;fila.classList.toggle("faltante",c);}
  });

  productos.forEach(p=>{
    const tr=document.createElement("tr");
    tr.innerHTML=`<td>${p}</td><td><input type="checkbox" onchange="toggleFila(this)"></td>`;
    lista.appendChild(tr);
  });
  cargarEstado();

  function toggleFila(c){const tr=c.closest("tr");tr.classList.toggle("faltante",c.checked);guardarEstado();}
  function cambiarTodos(v){lista.querySelectorAll("input").forEach(c=>{c.checked=v;toggleFila(c);});}
  function obtenerFaltantes(){return [...lista.rows].filter(r=>r.querySelector("input").checked).map(r=>r.cells[0].innerText);}
  function descargarPDF(){
    const {jsPDF}=window.jspdf,doc=new jsPDF(),faltantes=obtenerFaltantes();
    doc.setFontSize(16).text("Lista De Compras",20,20);
    doc.setFontSize(12);
    faltantes.length?faltantes.forEach((f,i)=>doc.text("- "+f,20,30+i*10)):doc.text("âœ… Todo completo.",20,30);
    doc.save("lista_compras.pdf");
  }
  function compartir(){
    const faltantes=obtenerFaltantes();
    const texto=faltantes.length?`ðŸ›’ Faltan:\n- ${faltantes.join("\n- ")}`:"âœ… Todo estÃ¡ completo.";
    window.open(`https://wa.me/?text=${encodeURIComponent(texto)}`,"_blank");
  }
  function agregarProducto(){
    const ni=document.getElementById("newItem"),nombre=ni.value.trim();
    if(nombre&&![...lista.rows].some(r=>r.cells[0].innerText===nombre)){
      const tr=document.createElement("tr");
      tr.innerHTML=`<td>${nombre}</td><td><input type="checkbox" onchange="toggleFila(this)"></td>`;
      lista.appendChild(tr);
      guardarEstado();
    }
    ni.value="";
  }
</script>
</body>
</html>
